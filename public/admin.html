<!DOCTYPE html>
<html lang="en">
<head>
    <title>Admin Dashboard</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="dashboard">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <h2>üõ°Ô∏è Admin Dashboard</h2>
            <button onclick="logout()">Logout</button>
        </div>

        <div class="card">
            <h3>‚ûï Add New Fee</h3>
            <input type="text" id="new-fee-name" placeholder="Fee Name (e.g., Lab Fee)">
            <input type="number" id="new-fee-amount" placeholder="Amount (INR)">
            <button onclick="addFee()">Add Fee</button>
        </div>

        <div class="card">
            <h3>üìú Transaction History</h3>
            <div style="overflow-x:auto;">
                <table>
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Fee Type</th>
                            <th>Amount</th>
                            <th>Receipt</th>
                        </tr>
                    </thead>
                    <tbody id="tx-table"></tbody>
                </table>
            </div>
        </div>

        <div class="chat-container">
            <h3>ü§ñ Admin AI Assistant</h3>
            <div id="chat-box"></div>
            <input type="text" id="bot-input" placeholder="Define a word...">
            <button onclick="sendMsg()">Ask AI</button>
        </div>
    </div>

    <script>
        async function loadPayments() {
            const res = await fetch('/api/admin/payments');
            const data = await res.json();
            const tbody = document.getElementById('tx-table');
            tbody.innerHTML = '';
            data.forEach(tx => {
                tbody.innerHTML += `
                    <tr>
                        <td>${new Date(tx.PaymentDate).toLocaleDateString()}</td>
                        <td>${tx.FeeName}</td>
                        <td>‚Çπ${tx.Amount}</td>
                        <td><a href="${tx.ReceiptURL}" target="_blank" style="color:#ff7f50; font-weight:bold;">View Receipt</a></td>
                    </tr>
                `;
            });
        }

        async function addFee() {
            const name = document.getElementById('new-fee-name').value;
            const amount = document.getElementById('new-fee-amount').value;
            await fetch('/api/admin/add-fee', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ feeName: name, amount })
            });
            alert('Fee Added Successfully!');
            location.reload();
        }

        async function sendMsg() {
            const text = document.getElementById('bot-input').value;
            const res = await fetch('/chat', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ message: text })
            });
            const data = await res.json();
            document.getElementById('chat-box').innerHTML += `<div><b>Admin:</b> ${text}</div><div style="color:#667eea"><b>Bot:</b> ${data.response}</div>`;
            document.getElementById('bot-input').value = "";
        }

        function logout() { localStorage.clear(); window.location.href = 'portal.html'; }

        loadPayments();
    </script>
</body>
</html>